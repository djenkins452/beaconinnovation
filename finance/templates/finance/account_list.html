{% extends "finance/base.html" %}

{% block title %}Accounts{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>Accounts</h1>
        <a href="{% url 'finance:account_create' %}" class="btn btn-primary">+ New Account</a>
    </div>

    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        <div style="flex: 1; padding: 20px; background-color: #e8f5e9; border-radius: 8px; text-align: center;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Cash Available</div>
            <div style="font-size: 28px; font-weight: bold; color: #27ae60;">${{ total_checking|floatformat:2 }}</div>
            <div style="font-size: 12px; color: #888;">Checking + Savings</div>
        </div>
        <div style="flex: 1; padding: 20px; background-color: #fff3e0; border-radius: 8px; text-align: center;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Credit Balance</div>
            <div style="font-size: 28px; font-weight: bold; color: #f39c12;">${{ total_credit|floatformat:2 }}</div>
            <div style="font-size: 12px; color: #888;">Amount Owed</div>
        </div>
        <div style="flex: 1; padding: 20px; background-color: #e3f2fd; border-radius: 8px; text-align: center;">
            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">Net Position</div>
            {% with net=total_checking|add:total_savings|add:"-"|add:total_credit %}
            <div style="font-size: 28px; font-weight: bold; color: #2980b9;">${{ total_checking|add:total_savings|floatformat:2 }}</div>
            {% endwith %}
            <div style="font-size: 12px; color: #888;">Cash - Credit</div>
        </div>
    </div>

    {% if accounts %}
    <table>
        <thead>
            <tr>
                <th>Account</th>
                <th>Type</th>
                <th>Institution</th>
                <th style="text-align: right;">Balance</th>
                <th style="text-align: center;">Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for account in accounts %}
            <tr {% if not account.is_active %}style="opacity: 0.6;"{% endif %}>
                <td>
                    <a href="{% url 'finance:account_detail' account.id %}" style="font-weight: 500;">
                        {{ account.name }}
                    </a>
                    {% if account.last_four %}
                    <span class="text-muted">(*{{ account.last_four }})</span>
                    {% endif %}
                    {% if account.is_personal %}
                    <span class="badge" style="background-color: #9b59b6; color: white; font-size: 10px;">Personal</span>
                    {% endif %}
                </td>
                <td>{{ account.get_account_type_display }}</td>
                <td>{{ account.institution }}</td>
                <td style="text-align: right;">
                    {% if account.account_type == 'credit_card' %}
                    <span style="color: {% if account.current_balance > 0 %}#e74c3c{% else %}#27ae60{% endif %};">
                        ${{ account.current_balance|floatformat:2 }}
                    </span>
                    {% else %}
                    <span style="color: {% if account.current_balance >= 0 %}#27ae60{% else %}#e74c3c{% endif %};">
                        ${{ account.current_balance|floatformat:2 }}
                    </span>
                    {% endif %}
                </td>
                <td style="text-align: center;">
                    {% if account.is_active %}
                    <span class="badge badge-income">Active</span>
                    {% else %}
                    <span class="badge" style="background-color: #95a5a6; color: white;">Inactive</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'finance:account_detail' account.id %}" class="btn btn-secondary" style="padding: 3px 8px; font-size: 11px;">View</a>
                    <a href="{% url 'finance:account_edit' account.id %}" class="btn btn-secondary" style="padding: 3px 8px; font-size: 11px;">Edit</a>
                    <form action="{% url 'finance:account_toggle_active' account.id %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-secondary" style="padding: 3px 8px; font-size: 11px;">
                            {% if account.is_active %}Deactivate{% else %}Activate{% endif %}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No accounts yet. Click "New Account" to add one.</p>
    {% endif %}
</div>
{% endblock %}
